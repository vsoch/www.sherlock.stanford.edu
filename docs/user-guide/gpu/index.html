 <!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="Sherlock Cluster documentation"><link rel="canonical" href="https://www.sherlock.stanford.edu/docs/user-guide/gpu/"><meta name="author" content="Kilian Cavalotti"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\_\-\.]+"><link rel="shortcut icon" href="../../../img/logo_small.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>GPU nodes - Sherlock</title><link rel="stylesheet" href="../../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../../assets/stylesheets/application-palette.fe74ad26.css"><meta name="theme-color" content=""><script src="../../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../../assets/fonts/material-icons.css"><link rel="manifest" href="../../../manifest.webmanifest"><link rel="stylesheet" href="../../.."><script>window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-68034405-2", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body dir="ltr" data-md-color-primary="stanford" data-md-color-accent="stanford"><svg class="md-svg"><defs><svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#gpu-nodes" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="https://www.sherlock.stanford.edu/" title="Sherlock" class="md-header-nav__button md-logo"><img src="../../../img/logo_small.png" width="24" height="24"></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Sherlock</span><span class="md-header-nav__topic">GPU nodes</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div><div class="md-flex__cell md-flex__cell--shrink"><div class="md-header-nav__source"><a href="https://github.com/stanford-rc/" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">SRCC <i class="fa fa-heart-o"></i> Open Source</div></a></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="https://www.sherlock.stanford.edu/" title="Sherlock" class="md-nav__button md-logo"><img src="../../../img/logo_small.png" width="48" height="48"></a>Sherlock</label><div class="md-nav__source"><a href="https://github.com/stanford-rc/" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">SRCC <i class="fa fa-heart-o"></i> Open Source</div></a></div><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1"><label class="md-nav__link" for="nav-1">Overview</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-1">Overview</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../overview/introduction/" title="Introduction" class="md-nav__link">Introduction</a></li><li class="md-nav__item"><a href="../../overview/concepts/" title="Concepts" class="md-nav__link">Concepts</a></li><li class="md-nav__item"><a href="../../overview/glossary/" title="Glossary" class="md-nav__link">Glossary</a></li><li class="md-nav__item"><a href="../../overview/specs/" title="Tech specs" class="md-nav__link">Tech specs</a></li><li class="md-nav__item"><a href="../../overview/status/" title="Status" class="md-nav__link">Status</a></li><li class="md-nav__item"><a href="../../overview/about/" title="About" class="md-nav__link">About</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2"><label class="md-nav__link" for="nav-2">Getting Started</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">Getting Started</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../getting-started/prerequisites/" title="Prerequisites" class="md-nav__link">Prerequisites</a></li><li class="md-nav__item"><a href="../../getting-started/connecting/" title="Connecting" class="md-nav__link">Connecting</a></li><li class="md-nav__item"><a href="../../getting-started/submitting/" title="Submitting jobs" class="md-nav__link">Submitting jobs</a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked><label class="md-nav__link" for="nav-3">User guide</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">User guide</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../running-jobs/" title="Running jobs" class="md-nav__link">Running jobs</a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2" checked><label class="md-nav__link" for="nav-3-2">Specialized resources</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-2">Specialized resources</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">GPU nodes</label><a href="./" title="GPU nodes" class="md-nav__link md-nav__link--active">GPU nodes</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#gpu-nodes" title="GPU nodes" class="md-nav__link">GPU nodes</a></li><li class="md-nav__item"><a href="#submitting-a-gpu-job" title="Submitting a GPU job" class="md-nav__link">Submitting a GPU job</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#interactive-session" title="Interactive session" class="md-nav__link">Interactive session</a></li><li class="md-nav__item"><a href="#gpu-types" title="GPU types" class="md-nav__link">GPU types</a></li><li class="md-nav__item"><a href="#gpu-compute-modes" title="GPU compute modes" class="md-nav__link">GPU compute modes</a></li></ul></nav></li><li class="md-nav__item"><a href="#environment-and-diagnostic-tools" title="Environment and diagnostic tools" class="md-nav__link">Environment and diagnostic tools</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#nvtop" title="nvtop" class="md-nav__link">nvtop</a></li></ul></nav></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="../ondemand/" title="OnDemand" class="md-nav__link">OnDemand</a></li><li class="md-nav__item"><a href="../troubleshoot/" title="Troubleshooting" class="md-nav__link">Troubleshooting</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4"><label class="md-nav__link" for="nav-4">Storage</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-4">Storage</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../storage/overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../storage/filesystems/" title="Filesystems" class="md-nav__link">Filesystems</a></li><li class="md-nav__item"><a href="../../storage/data-sharing/" title="Data sharing" class="md-nav__link">Data sharing</a></li><li class="md-nav__item"><a href="../../storage/data-protection/" title="Data protection" class="md-nav__link">Data protection</a></li><li class="md-nav__item"><a href="../../storage/data-transfer/" title="Data transfer" class="md-nav__link">Data transfer</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5"><label class="md-nav__link" for="nav-5">Software</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-5">Software</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../software/overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../software/list/" title="List" class="md-nav__link">List</a></li><li class="md-nav__item"><a href="../../software/modules/" title="Modules" class="md-nav__link">Modules</a></li><li class="md-nav__item"><a href="../../software/install/" title="Installation" class="md-nav__link">Installation</a></li><li class="md-nav__item"><a href="../../software/containers/" title="Containers" class="md-nav__link">Containers</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-6" type="checkbox" id="nav-5-6"><label class="md-nav__link" for="nav-5-6">Usage</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-5-6">Usage</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../software/using/R/" title="R" class="md-nav__link">R</a></li><li class="md-nav__item"><a href="../../software/using/julia/" title="Julia" class="md-nav__link">Julia</a></li><li class="md-nav__item"><a href="../../software/using/python/" title="Python" class="md-nav__link">Python</a></li><li class="md-nav__item"><a href="../../software/using/perl/" title="Perl" class="md-nav__link">Perl</a></li><li class="md-nav__item"><a href="../../software/using/spark/" title="Spark" class="md-nav__link">Spark</a></li><li class="md-nav__item"><a href="../../software/using/mariadb/" title="MariaDB" class="md-nav__link">MariaDB</a></li><li class="md-nav__item"><a href="../../software/using/postgresql/" title="PostgreSQL" class="md-nav__link">PostgreSQL</a></li><li class="md-nav__item"><a href="../../software/using/singularity/" title="Singularity" class="md-nav__link">Singularity</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6"><label class="md-nav__link" for="nav-6">Advanced topics</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-6">Advanced topics</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../advanced-topics/connection/" title="Connection" class="md-nav__link">Connection</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#gpu-nodes" title="GPU nodes" class="md-nav__link">GPU nodes</a></li><li class="md-nav__item"><a href="#submitting-a-gpu-job" title="Submitting a GPU job" class="md-nav__link">Submitting a GPU job</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#interactive-session" title="Interactive session" class="md-nav__link">Interactive session</a></li><li class="md-nav__item"><a href="#gpu-types" title="GPU types" class="md-nav__link">GPU types</a></li><li class="md-nav__item"><a href="#gpu-compute-modes" title="GPU compute modes" class="md-nav__link">GPU compute modes</a></li></ul></nav></li><li class="md-nav__item"><a href="#environment-and-diagnostic-tools" title="Environment and diagnostic tools" class="md-nav__link">Environment and diagnostic tools</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#nvtop" title="nvtop" class="md-nav__link">nvtop</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><a href="https://github.com/stanford-rc/www.sherlock.stanford.edu/edit/docs/src/docs/user-guide/gpu.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a><h1>GPU nodes</h1><p>To support the latest computing evolutions in many fields of science, Sherlock
provides GPU nodes that can be used to run a variety of GPU-accelerated
applications. Those nodes are available to everyone, but are a scarce,
highly-demanded resource, so getting access to them may require some wait time
in queue.</p>
<div class="admonition info">
<p class="admonition-title">Getting your own GPU nodes</p>
<p>If you need frequent access to GPU nodes, we recommend considering
<a href="/docs/overview/concepts/#the-condominium-model">becoming an owner on Sherlock</a>, so you can have immediate
access to your GPU nodes when you need them.</p>
</div>
<h2 id="gpu-nodes">GPU nodes<a class="headerlink" href="#gpu-nodes" title="Permanent link">#</a></h2>
<p>A limited number of GPU nodes are available in the <code>gpu</code> partition. Anybody
running on Sherlock can submit a job there. As owners contribute to expand
Sherlock, more GPU nodes are added to the <code>owners</code> partition, for use by PI
groups which purchased their own compute nodes.</p>
<div class="admonition tip">
<p class="admonition-title">More GPU types to come</p>
<p>As we merge cluster nodes during Phase 2, the existing Sherlock 1.0 GPU
nodes will be added to the <code>gpu</code> partition on Sherlock 2.0</p>
</div>
<p>There currently are two types of GPUs available in the <code>gpu</code> partition:</p>
<ul>
<li>NVIDIA Tesla P100-PCIe<sup id="fnref:p100"><a class="footnote-ref" href="#fn:p100">1</a></sup>, for applications requiring double-precision
  (64-bit) and deep-learning training workloads,</li>
<li>NVIDIA Tesla P40<sup id="fnref:p40"><a class="footnote-ref" href="#fn:p40">2</a></sup>, for single- or half-precision (32, 16-bit) workloads
  and deep-learning inference jobs.</li>
</ul>
<h2 id="submitting-a-gpu-job">Submitting a GPU job<a class="headerlink" href="#submitting-a-gpu-job" title="Permanent link">#</a></h2>
<p>To submit a GPU job, you'll need to use the <code>--gres</code> option in your batch script
or command line submission options.</p>
<p>For instance, the following script will request one GPU for two hours in the
<code>gpu</code> partition, and run the GPU-enabled version of <code>gromacs</code>:</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH -p gpu</span>
<span class="c1">#SBATCH -c 10</span>
<span class="c1">#SBATCH --gres gpu:1</span>

ml load gromacs/2016.3

srun gmx_gpu ...
</pre></div>

<p>You can also directly run GPU processes on compute nodes with <code>srun</code>. For
instance, the following command will display details about the GPUs allocated
to your job:</p>
<div class="codehilite"><pre><span></span>$ srun -p gpu --gres gpu:2 nvidia-smi
Fri Jul 28 12:41:49 2017
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 375.51                 Driver Version: 375.51                    |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  Tesla P40           On   | 0000:03:00.0     Off |                    0 |
| N/A   26C    P8    10W / 250W |      0MiB / 22912MiB |      0%   E. Process |
+-------------------------------+----------------------+----------------------+
|   1  Tesla P40           On   | 0000:04:00.0     Off |                    0 |
| N/A   24C    P8    10W / 250W |      0MiB / 22912MiB |      0%   E. Process |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID  Type  Process name                               Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
</pre></div>

<div class="admonition warning">
<p class="admonition-title">GPU resources MUST be requested explicitly</p>
<p>Jobs will be rejected at submission time if they don't explictly request
GPU resources.</p>
</div>
<p>The <code>gpu</code> partition only accepts jobs explicitly requesting GPU resources. If
they don't, they will be rejected with the following message:</p>
<div class="codehilite"><pre><span></span>$ srun -p gpu --pty bash
srun: error: Unable to allocate resources: Job violates accounting/QOS policy (job submit limit, user&#39;s size and/or time limits)
</pre></div>

<h3 id="interactive-session">Interactive session<a class="headerlink" href="#interactive-session" title="Permanent link">#</a></h3>
<p>As for any other compute node, you can submit an interactive job and request a
shell on a GPU node with the following command:</p>
<div class="codehilite"><pre><span></span>$ srun -p gpu --gres gpu:1 --pty bash
srun: job 38068928 queued and waiting for resources
srun: job 38068928 has been allocated resources
$ nvidia-smi --query-gpu=index,name --format=csv,noheader
0, Tesla V100-SXM2-16GB
</pre></div>

<h3 id="gpu-types">GPU types<a class="headerlink" href="#gpu-types" title="Permanent link">#</a></h3>
<p>Since Sherlock features many different types of GPUs, each with its own
technical characteristics, performance profiles and specificities, you may want
to ensure that your job runs on a specific type of GPU.</p>
<p>To that end, Slurm allows users to specify <em>constraints</em> when submitting jobs,
which will indicate the scheduler that only nodes having features matching the
job constraints could be used to satisfy the request. Multiple constraints may
be specified and combined with various operators (please refer to the official
<a href="//slurm.schedmd.com/sbatch.html#OPT_constraint">Slurm documentation</a> for details).</p>
<p>The list of available features on GPU nodes can be obtained with the
<code>node_feat</code><sup id="fnref:node_feat"><a class="footnote-ref" href="#fn:node_feat">3</a></sup> command:</p>
<div class="codehilite"><pre><span></span>$ node_feat -p gpu | grep GPU_
GPU_BRD:TESLA
GPU_GEN:PSC
GPU_MEM:16GB
GPU_MEM:24GB
GPU_SKU:TESLA_P100_PCIE
GPU_SKU:TESLA_P40
</pre></div>

<p><code>node_feat</code> will only list the features of nodes from partitions you have
access to, so output may vary depending on your group membership.</p>
<p>The different characteristics<sup id="fnref:values"><a class="footnote-ref" href="#fn:values">4</a></sup> of various GPU types are listed in the following
table</p>
<table>
<thead>
<tr>
<th>Slurm&nbsp;feature</th>
<th>Description</th>
<th>Possible values</th>
<th>Example job constraint</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GPU_BRD</code></td>
<td>GPU brand</td>
<td><code>GEFORCE</code>: GeForce / TITAN<br><code>TESLA</code>: Tesla</td>
<td><code>#SBATCH -C GPU_BRD:TESLA</code></td>
</tr>
<tr>
<td><code>GPU_GEN</code></td>
<td>GPU generation</td>
<td><code>PSC</code>: Pascal<br><code>MXW</code>: Maxwell</td>
<td><code>#SBATCH -C GPU_GEN:PSC</code></td>
</tr>
<tr>
<td><code>GPU_MEM</code></td>
<td>Amount of GPU memory</td>
<td><code>16GB</code>, <code>24GB</code></td>
<td><code>#SBATCH -C GPU_MEM:16GB</code></td>
</tr>
<tr>
<td><code>GPU_SKU</code></td>
<td>GPU model</td>
<td><code>TESLA_P100_PCIE</code><br/><code>TESLA_P40</code></td>
<td><code>#SBATCH -C GPU_SKU:TESLA_P40</code></td>
</tr>
</tbody>
</table>
<p>Depending on the partitions you have access to, more features may be available
to be requested in your jobs.</p>
<p>For instance, to request a Tesla GPU for you job, you can use the following
submisison options:</p>
<div class="codehilite"><pre><span></span>$ srun -p owners --gres gpu:1 -C GPU_BRD:TESLA nvidia-smi -L
GPU 0: Tesla P100-SXM2-16GB (UUID: GPU-4f91f58f-f3ea-d414-d4ce-faf587c5c4d4)
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Unsatisfiable contraints</p>
<p>If you specify a constraint that can't be satisfied in the partition you're
submitting your job to, the job will be rejected by the scheduler.     For
instance, requesting a GeForce GPU in the <code>gpu</code> partition, which only
features Tesla GPUs, will result in an error:</p>
<div class="codehilite"><pre><span></span>$ srun -p gpu --gres gpu:1 -C GPU_BRD:GEFORCE nvidia-smi -L
srun: error: Unable to allocate resources: Requested node configuration is not available
</pre></div>

</div>
<h3 id="gpu-compute-modes">GPU compute modes<a class="headerlink" href="#gpu-compute-modes" title="Permanent link">#</a></h3>
<p>By default, GPUs on Sherlock are set in the <strong>Exclusive Process</strong> compute
mode<sup id="fnref:gpu_cmodes"><a class="footnote-ref" href="#fn:gpu_cmodes">5</a></sup>, to provide the best performance and an isolated environment
for jobs, out of the box.</p>
<p>Some software may require GPUs to be set to a different compute mode, for
instance to share a GPU across different processes within the same application.</p>
<p>To handle that case, we developed a specific option, <code>--gpu_cmode</code>, that users
can add to their <code>srun</code> and <code>sbatch</code> submission options, to choose the compute
mode for the GPUs allocated to their job.</p>
<p>Here's the list of the different compute modes supported on Sherlock's GPUs:</p>
<table>
<thead>
<tr>
<th>GPU&nbsp;compute&nbsp;mode</th>
<th><code>--gpu_cmode</code> option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>"Default"</td>
<td><code>shared</code></td>
<td>Multiple contexts are allowed per device (NVIDIA default)</td>
</tr>
<tr>
<td>"Exclusive Process"</td>
<td><strong><code>exclusive</code></strong></td>
<td>Only one context is allowed per device, usable from multiple threads at a time (Sherlock default)</td>
</tr>
<tr>
<td>"Prohibited"</td>
<td><code>prohibited</code></td>
<td>No CUDA context can be created on the device</td>
</tr>
</tbody>
</table>
<p>By default, or if the <code>--gpu_cmode</code> option is not specified, GPUs will be set
in the "Exclusive Process" mode, as demonstrated by this example command:</p>
<div class="codehilite"><pre><span></span>$ srun -p gpu --gres gpu:1 nvidia-smi
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 387.26                 Driver Version: 387.26                    |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  Tesla P40           On   | 00000000:03:00.0 Off |                    0 |
| N/A   22C    P8    10W / 250W |      0MiB / 22912MiB |      0%   E. Process |
+-------------------------------+----------------------+----------------------+
</pre></div>

<p>With the <code>--gpu_cmode</code> option, the scheduler will set the GPU compute mode to
the desired value before execution:</p>
<div class="codehilite"><pre><span></span>$ srun -p gpu --gres gpu:1 --gpu_cmode=shared nvidia-smi
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 387.26                 Driver Version: 387.26                    |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  Tesla P40           On   | 00000000:03:00.0 Off |                    0 |
| N/A   22C    P8    10W / 250W |      0MiB / 22912MiB |      0%      Default |
+-------------------------------+----------------------+----------------------+
</pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>"Default" is the name that the NVIDIA System Management Interface
(<code>nvidia-smi</code>) uses to describe the mode where a GPU can be shared between
different processes. It does not represent the default GPU compute mode on
Sherlock, which is "Exclusive Process".</p>
</div>
<h2 id="environment-and-diagnostic-tools">Environment and diagnostic tools<a class="headerlink" href="#environment-and-diagnostic-tools" title="Permanent link">#</a></h2>
<div class="admonition bug">
<p class="admonition-title"><img alt="🚧" class="emojione" src="https://cdn.jsdelivr.net/emojione/assets/svg/1f6a7.svg" title=":construction:" /> Work in progress <img alt="🚧" class="emojione" src="https://cdn.jsdelivr.net/emojione/assets/svg/1f6a7.svg" title=":construction:" /></p>
<p>This page is a work in progress and is not complete yet. We are actively
working on adding more content and information.</p>
</div>
<h3 id="nvtop"><code>nvtop</code><a class="headerlink" href="#nvtop" title="Permanent link">#</a></h3>
<p>GPU usage information can be shown with the <a href="https://github.com/Syllo/nvtop"><code>nvtop</code></a> tool. <code>nvtop</code>
is available as a <a href="/docs/software/modules">module</a>, which can be loaded like this:</p>
<div class="codehilite"><pre><span></span>$ ml load system nvtop
</pre></div>

<p><code>nvtop</code> provides an <a href="https://hisham.hm/htop/"><code>htop</code></a>-like interactive view of GPU
utilization.  Users can monitor, estimate and fine tune their GPU resource
requests with this tool.  Percent GPU and memory utilization is shown as a
user's GPU code is running.</p>
<p><img alt="nvtop" src="../img/nvtop.png" /></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:p100">
<p>See the complete <a href="//images.nvidia.com/content/tesla/pdf/nvidia-tesla-p100-PCIe-datasheet.pdf">Tesla P100 technical specifications</a> for
  details.&#160;<a class="footnote-backref" href="#fnref:p100" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:p40">
<p>See the complete <a href="//images.nvidia.com/content/pdf/tesla/184427-Tesla-P40-Datasheet-NV-Final-Letter-Web.pdf">Tesla P40 technical specifications</a> for
  details.&#160;<a class="footnote-backref" href="#fnref:p40" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:node_feat">
<p>See <code>node_feat -h</code> for more details.&#160;<a class="footnote-backref" href="#fnref:node_feat" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:values">
<p>The lists of values provided in the table are non exhaustive.&#160;<a class="footnote-backref" href="#fnref:values" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:gpu_cmodes">
<p>The list of available GPU compute modes and relevant details are
  available in the <a href="http://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#compute-modes">CUDA Toolkit Documentation</a>&#160;<a class="footnote-backref" href="#fnref:gpu_cmodes" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
</ol>
</div></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../running-jobs/" title="Running jobs" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>Running jobs</span></div></a><a href="../ondemand/" title="OnDemand" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next"><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Next</span>OnDemand</span></div><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright"><div class="md-footer-copyright__highlight">Copyright &copy; 2014 - 2018 &mdash; <a href='mailto:srcc-support@stanford.edu'>Stanford Research Computing Center</a></div> Made with <i class="fa fa-heart md-highlight"></i> in <span class="md-footer-copyright__highlight"><a href='https://www.google.com/maps/place/Stanford,+CA'>Stanford, California</a> </span></div><div class="md-footer-social"><link rel="stylesheet" href="../../../assets/fonts/font-awesome.css"> <a href="https://srcc.stanford.edu" class="md-footer-social__link fa fa-globe"></a>  <a href="https://github.com/stanford-rc" class="md-footer-social__link fa fa-github"></a>  <a href="https://twitter.com/StanfordCompute" class="md-footer-social__link fa fa-twitter"></a>  <a href="https://www.linkedin.com/school/1792/" class="md-footer-social__link fa fa-linkedin"></a> </div></div></div></footer></div><script src="../../../assets/javascripts/application.9e29383c.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script><script src="../../.."></script><script src="../../../search/main.js"></script></body></html>